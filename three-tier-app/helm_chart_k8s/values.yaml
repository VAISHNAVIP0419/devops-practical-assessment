# Three-Tier MERN Application - Helm Chart Values
# Configure frontend, backend, and MongoDB database deployment

# Global namespace configuration
namespace:
  name: three-tier
  create: true

# Image pull secrets for private registries
imagePullSecrets:
  - name: ecr-registry-secret

# Frontend (React) Configuration
frontend:
  enabled: true
  replicaCount: 1
  image:
    repository: 047719648597.dkr.ecr.ap-south-1.amazonaws.com/three-tire-app-frontend
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 3000
  env:
    REACT_APP_BACKEND_URL: "/api/tasks"

# Backend (Node.js/Express) Configuration
backend:
  enabled: true
  replicaCount: 2
  image:
    repository: 047719648597.dkr.ecr.ap-south-1.amazonaws.com/three-tire-app-backend
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 3500
  env:
    MONGO_CONN_STR: "mongodb://mongodb-svc:27017/todo?directConnection=true"
  mongoSecret:
    name: mongo-sec
    usernameKey: username
    passwordKey: password
  probes:
    liveness:
      path: /healthz
      port: 3500
      initialDelaySeconds: 5
      periodSeconds: 10
    readiness:
      path: /ready
      port: 3500
      initialDelaySeconds: 5
      periodSeconds: 5
    startup:
      path: /started
      port: 3500
      initialDelaySeconds: 0
      periodSeconds: 10
      failureThreshold: 30

# MongoDB Database Configuration
mongodb:
  enabled: true
  replicaCount: 1
  image:
    repository: mongo
    tag: "4.4.6"
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 27017
  mongoSecret:
    name: mongo-sec
    usernameKey: username
    passwordKey: password
  persistence:
    enabled: true
    size: 1Gi
    storageClassName: ""  # Use default StorageClass if empty
  mongodbSettings:
    cacheSizeGB: "0.1"
    bindIp: "0.0.0.0"

# Ingress Configuration (ALB)
ingress:
  enabled: true
  className: alb
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}]'

# Cluster Autoscaler Configuration
autoscaler:
  enabled: false
  clusterName: "three-tier-eks"
  image:
    repository: registry.k8s.io/autoscaling/cluster-autoscaler
    tag: v1.32.1
    pullPolicy: Always
  resources:
    limits:
      cpu: 100m
      memory: 600Mi
    requests:
      cpu: 100m
      memory: 600Mi

# Resource limits for pods (optional)
resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# Node selection and affinity rules
nodeSelector: {}
tolerations: []
affinity: {}
